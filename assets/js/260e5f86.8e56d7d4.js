(self.webpackChunkamazon_connect_salesforce_cti=self.webpackChunkamazon_connect_salesforce_cti||[]).push([[551],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return p},kt:function(){return u}});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=r.createContext({}),l=function(e){var t=r.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),g=l(a),u=n,d=g["".concat(c,".").concat(u)]||g[u]||m[u]||i;return a?r.createElement(d,o(o({ref:t},p),{},{components:a})):r.createElement(d,o({ref:t},p))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=g;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:n,o[1]=s;for(var l=2;l<i;l++)o[l]=a[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}g.displayName="MDXCreateElement"},3919:function(e,t,a){"use strict";function r(e){return!0===/^(\w*:|\/\/)/.test(e)}function n(e){return void 0!==e&&!r(e)}a.d(t,{b:function(){return r},Z:function(){return n}})},4996:function(e,t,a){"use strict";a.d(t,{C:function(){return i},Z:function(){return o}});var r=a(2263),n=a(3919);function i(){var e=(0,r.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,a=void 0===t?"/":t,i=e.url;return{withBaseUrl:function(e,t){return function(e,t,a,r){var i=void 0===r?{}:r,o=i.forcePrependBaseUrl,s=void 0!==o&&o,c=i.absolute,l=void 0!==c&&c;if(!a)return a;if(a.startsWith("#"))return a;if((0,n.b)(a))return a;if(s)return t+a;var p=a.startsWith(t)?a:t+a.replace(/^\//,"");return l?e+p:p}(i,a,e,t)}}}function o(e,t){return void 0===t&&(t={}),(0,i().withBaseUrl)(e,t)}},2642:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return c},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return m},default:function(){return u}});var r=a(2122),n=a(9756),i=(a(7294),a(3905)),o=a(4996),s=["components"],c={id:"04-call-recording-link-for-task",title:"Call Recording Link for Task"},l=void 0,p={unversionedId:"classic/cti-adapter/04-call-recording-link-for-task",id:"classic/cti-adapter/04-call-recording-link-for-task",isDocsHomePage:!1,title:"Call Recording Link for Task",description:"The Adapter comes with a Visualforce component that provides users with",source:"@site/docs/classic/03-cti-adapter/04-call-recording-link-for-task.md",sourceDirName:"classic/03-cti-adapter",slug:"/classic/cti-adapter/04-call-recording-link-for-task",permalink:"/amazon-connect-salesforce-cti/docs/classic/cti-adapter/04-call-recording-link-for-task",editUrl:"https://github.com/amazon-connect/amazon-connect-salesforce-cti/docs/classic/03-cti-adapter/04-call-recording-link-for-task.md",version:"current",sidebarPosition:4,frontMatter:{id:"04-call-recording-link-for-task",title:"Call Recording Link for Task"},sidebar:"classic",previous:{title:"Contact Attributes Display",permalink:"/amazon-connect-salesforce-cti/docs/classic/cti-adapter/03-contact-attributes-display"},next:{title:"Call Display on the Account Page",permalink:"/amazon-connect-salesforce-cti/docs/classic/cti-adapter/05-call-display-account-page"}},m=[],g={toc:m};function u(e){var t=e.components,a=(0,n.Z)(e,s);return(0,i.kt)("wrapper",(0,r.Z)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The Adapter comes with a Visualforce component that provides users with\nthe ability to download a call recording created within Amazon Connect\nfrom a Salesforce page."),(0,i.kt)("h5",{id:"cloudformation-template"},"Cloudformation Template"),(0,i.kt)("p",null,"To make sure that the AWS resources are set up, make sure that the\n",(0,i.kt)("em",{parentName:"p"},"PostcallRecordingImportEnabled")," parameter is set to true in your\nCloudformation stack:"),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming0.png")}),(0,i.kt)("h5",{id:"aws-side-setup"},"AWS Side Setup"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"See ",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-trusted-signers.html"},"these steps"),". Follow the sections ",(0,i.kt)("em",{parentName:"p"},"Creating key pairs for your signers"),", and ",(0,i.kt)("em",{parentName:"p"},"Adding a signer to a distribution"),".\nMake sure to record the ",(0,i.kt)("strong",{parentName:"p"},"public key ID"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'Copy and paste the contents of the private key .pem file into a text editor. Replace every newline character with a space, and then delete the last character. This is most easily done using a "find and replace" feature in your text editor.\nThe resulting string of text should resemble the following:'))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"-----BEGIN RSA PRIVATE KEY----- (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (64 character string) (under 64 character string) -----END RSA PRIVATE KEY-----\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'Navigate to the "Secrets Manager" service. Select the ',(0,i.kt)("strong",{parentName:"p"},"SalesforceCredentials"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'Under the "Secret value" tab, select "Retrieve secret value" and then "Edit".')),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"For the ",(0,i.kt)("strong",{parentName:"p"},"CloudFrontPrivateKey")," field, copy and paste the modified contents of the private key .pem file. For the ",(0,i.kt)("strong",{parentName:"p"},"CloudFrontAccessKeyID")," field, copy and paste the ",(0,i.kt)("strong",{parentName:"p"},"Access Key Id")," you recorded above. Your Secrets Manager Secret should look like the following:"))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming1.png")}),(0,i.kt)("p",null,'Please note that your secret may also be formatted stored as a "Secret key/value" secret rather than a "Plaintext" secret; both secret types are valid.'),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},'Navigate to your Salesforce instance. Navigate to setup, then search for "Visualforce pages."')),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming2.png")}),(0,i.kt)("ol",{start:7},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Select the ",(0,i.kt)("strong",{parentName:"p"},"ACSFCCP_CallRecordingTask"),' visualforce page, and select "preview." Copy the url of the opened page up until ',(0,i.kt)("inlineCode",{parentName:"p"},".com"),". Make sure not to include any characters after ",(0,i.kt)("inlineCode",{parentName:"p"},".com"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Navigate back to aws, to the s3 bucket where your audio recording files are stored. This s3 bucket should be the same bucket as the ",(0,i.kt)("strong",{parentName:"p"},"ConnectRecordingS3BucketName")," parameter to the serverless application.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In the bucket details, select the ",(0,i.kt)("strong",{parentName:"p"},"Permissions")," tab and then the ",(0,i.kt)("strong",{parentName:"p"},"CORS configuration")," tab and paste the following. Replace the AllowedOrigin with the url copied in step 9."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "AllowedHeaders": ["Access-Control-Allow-Origin"],\n    "AllowedMethods": ["GET"],\n    "AllowedOrigins": ["{url copied in step 9}"],\n    "ExposeHeaders": []\n  }\n]\n')),(0,i.kt)("img",{src:(0,o.Z)("/img/lightning/image271.png")}),(0,i.kt)("ol",{start:10},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Select Save")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'Navigate to the "IAM" aws service. Select ',(0,i.kt)("strong",{parentName:"p"},"Add User"),"."))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming4.png")}),(0,i.kt)("ol",{start:12},(0,i.kt)("li",{parentName:"ol"},"Give your IAM user a name, like ",(0,i.kt)("strong",{parentName:"li"},"sfInvokeGenerateAudioRecordingStreamingURLIAMUser"),'. For the "AWS Access Type", select ',(0,i.kt)("strong",{parentName:"li"},"Programmatic access"),".")),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming5.png")}),(0,i.kt)("ol",{start:13},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'Select Next, then select "Attach existing policies directly." Search for ',(0,i.kt)("strong",{parentName:"p"},"invokeSfGenerateAudioRecordingStreamingURLPolicy")," and select it.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create the user, then copy down the ",(0,i.kt)("strong",{parentName:"p"},"Access key ID")," and the ",(0,i.kt)("strong",{parentName:"p"},"Secret access key"),". These keys will be used in the next section."))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming6.png")}),(0,i.kt)("ol",{start:15},(0,i.kt)("li",{parentName:"ol"},'Navigate to the "Lambda" aws service. Search for term "sfgenerate" and copy down the full name of the sfGenerateAudioRecordingStreaming lambda. This will be used in the next section.')),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming7.png")}),(0,i.kt)("ol",{start:16},(0,i.kt)("li",{parentName:"ol"},'Navigate back to the "Lambda" aws service main page and navigate to the ',(0,i.kt)("strong",{parentName:"li"},"us-east-1 region"),". Select ",(0,i.kt)("strong",{parentName:"li"},"create function"),".")),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming8.png")}),(0,i.kt)("ol",{start:17},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Enter a function name, like ",(0,i.kt)("strong",{parentName:"p"},"sfSig4RequestToS3"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Select ",(0,i.kt)("strong",{parentName:"p"},"change default execution role"),", and ",(0,i.kt)("strong",{parentName:"p"},"use an existing role"),". Search for and select ",(0,i.kt)("em",{parentName:"p"},"sfSig4RequestToS3Role"),"."))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming9.png")}),(0,i.kt)("ol",{start:19},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Select ",(0,i.kt)("strong",{parentName:"p"},"create function"),". On the next screen, copy and paste the contents from ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/amazon-connect/amazon-connect-salesforce-cti/blob/main/docs/lightning/04-salesforce-lambdas/sfSig4RequestToS3.js"},"this file")," into the function body, and then select ",(0,i.kt)("strong",{parentName:"p"},"Deploy"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Select the actions dropdown, and then select ",(0,i.kt)("strong",{parentName:"p"},"Deploy to Lambda@Edge"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'Select the Cloudfront Distribution that was created by the Salesfore Lambdas serverless application, then check off the "I acknowledge..." check box, then select deploy.'))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming10.png")}),(0,i.kt)("h5",{id:"salesforce-side-setup"},"Salesforce Side Setup"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'In Salesforce Setup, search for "Named Credentials." Select ',(0,i.kt)("strong",{parentName:"p"},"New Named Credential."))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"For the ",(0,i.kt)("strong",{parentName:"p"},"Name")," and ",(0,i.kt)("strong",{parentName:"p"},"Label"),", enter AwsGenerateAudioRecordingURL.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In the ",(0,i.kt)("strong",{parentName:"p"},"URL")," section, enter ",(0,i.kt)("inlineCode",{parentName:"p"},"https://lambda.{awsRegion}.amazonaws.com/2015-03-31/functions/{lambdaFunctionName}/invocations/"),"-- replace {awsRegion} with the awsRegion your serverless application resides in (for example, us-east-1), and replace {lambdaFunctionName} with the full name of the sfGenerateAudioRecordingStreaming lambda you recorded in the previous section.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"For ",(0,i.kt)("strong",{parentName:"p"},"Identity Type")," select ",(0,i.kt)("strong",{parentName:"p"},"Named Principal"),". For the ",(0,i.kt)("strong",{parentName:"p"},"Authentication Protocol"),", select ",(0,i.kt)("strong",{parentName:"p"},"AWS Signature Version 4"),". Fill in the ",(0,i.kt)("strong",{parentName:"p"},"Access key ID"),' you recorded in the previous section as "AWS Access Key ID", the ',(0,i.kt)("strong",{parentName:"p"},"Secret access key"),' as the "AWS Secret Access Key", the AWS Region, and "lambda" as the "AWS Service."'))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming11.png")}),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"Select ",(0,i.kt)("strong",{parentName:"li"},"save"),".")),(0,i.kt)("h4",{id:"enabling-call-recording-streaming"},"Enabling call recording streaming"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Login to your Amazon Connect instance as an Administrator")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"From the left navigation, choose ",(0,i.kt)("strong",{parentName:"p"},"Routing")," then select ",(0,i.kt)("strong",{parentName:"p"},"Contact\nflows")))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming12.png")}),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Open the contact flow that you want to use to enable call recording\nimport. This contact flow must have Amazon Connect's native\nrecording turned on.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In you contact flow, before you transfer to queue, add a new ",(0,i.kt)("strong",{parentName:"p"},"Set\ncontact attributes")," block")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Configure the block to set a contact attribute as follows:"),(0,i.kt)("p",{parentName:"li"},"a. ",(0,i.kt)("strong",{parentName:"p"},"Destination key:")," postcallRecordingImportEnabled"),(0,i.kt)("p",{parentName:"li"},"b. ",(0,i.kt)("strong",{parentName:"p"},"Value:")," true"))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming13.png")}),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Save")," the Set contact attributes block. Make sure it is\nappropriately connected to your contact flow, and ",(0,i.kt)("strong",{parentName:"p"},"Publish")," the\nflow.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Wait approximately 2 minutes to give the contact flow time to\npublish."))),(0,i.kt)("p",null,"To edit the sample Task Page Layout, please follow the steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Log in to your Salesforce Org")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Navigate to ",(0,i.kt)("strong",{parentName:"p"},"Setup")," then in type ",(0,i.kt)("em",{parentName:"p"},"Object Manager")," in Quick Find"))),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming14.png")}),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},'Click on the "Task" object')),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming15.png")}),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},'Click on the "Page Layouts"')),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming16.png")}),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},'Click on the "',(0,i.kt)("em",{parentName:"li"},"Task Layout"),'" and the layout designer will open')),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming17.png")}),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},'Drag the "ACSFCCP_CallRecording" item to the desired are of the layout to have that information appear on the agent\'s screen. The following screenshot shows how the Call Details section could appear when placing the "ACSFCCP_CallRecording" item on the required Task layout.')),(0,i.kt)("img",{src:(0,o.Z)("/img/classic/audiostreaming18.png")}),(0,i.kt)("ol",{start:7},(0,i.kt)("li",{parentName:"ol"},"To have access to the recording, the user must have an active session with Amazon Connect. This can be achieved by either logging in to the CCP softphone, or by logging in to Amazon Connect outside of Salesforce. After the session is established, a page refresh should make the player appear.")),(0,i.kt)("h4",{id:"common-audio-streaming-setup-issues"},"Common Audio Streaming Setup Issues"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Verify that the Secrets Manager secret contains both the ",(0,i.kt)("inlineCode",{parentName:"p"},"CloudFrontPrivateKey")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"CloudFrontAccessKeyID")," items.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Verify that your Cloudfront distribution's behavior is set to use ",(0,i.kt)("inlineCode",{parentName:"p"},"Trusted Key Groups"),", and that the correct Key Group is selected."))),(0,i.kt)("img",{src:(0,o.Z)("/img/shared/audiostreamingkeygroups.png")}),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Verify that your Cloudfront distribution's behavior contains the sfSig4RequestToS3 edge lambda")),(0,i.kt)("img",{src:(0,o.Z)("/img/shared/audiostreamingedgelambda.png")}),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"Verify that your S3 bucket CORS configuration is correct")),(0,i.kt)("img",{src:(0,o.Z)("/img/shared/audiostreamingcorsconfiguration.png")}),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Verify that your named credentials are correctly set up")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Verify that your user is added to the AC_CallRecording permission set"))))}u.isMDXComponent=!0}}]);