<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<link rel="search" type="application/opensearchdescription+xml" title="Amazon Connect Salesforce CTI Adapter" href="/amazon-connect-salesforce-cti/opensearch.xml"><title data-react-helmet="true">Setting Up The Salesforce Lambdas Manually | Amazon Connect Salesforce CTI Adapter</title><meta data-react-helmet="true" property="og:url" content="https://amazon-connect.github.io/amazon-connect-salesforce-cti//amazon-connect-salesforce-cti/docs/classic/installation/04-salesforce-lambdas-manual-setup"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Setting Up The Salesforce Lambdas Manually | Amazon Connect Salesforce CTI Adapter"><meta data-react-helmet="true" name="description" content="Below are manual setup instructions for the Salesforce Lambdas."><meta data-react-helmet="true" property="og:description" content="Below are manual setup instructions for the Salesforce Lambdas."><link data-react-helmet="true" rel="shortcut icon" href="/amazon-connect-salesforce-cti/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://amazon-connect.github.io/amazon-connect-salesforce-cti//amazon-connect-salesforce-cti/docs/classic/installation/04-salesforce-lambdas-manual-setup"><link data-react-helmet="true" rel="alternate" href="https://amazon-connect.github.io/amazon-connect-salesforce-cti//amazon-connect-salesforce-cti/docs/classic/installation/04-salesforce-lambdas-manual-setup" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://amazon-connect.github.io/amazon-connect-salesforce-cti//amazon-connect-salesforce-cti/docs/classic/installation/04-salesforce-lambdas-manual-setup" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/amazon-connect-salesforce-cti/assets/css/styles.72280d89.css">
<link rel="preload" href="/amazon-connect-salesforce-cti/assets/js/runtime~main.c8b8a721.js" as="script">
<link rel="preload" href="/amazon-connect-salesforce-cti/assets/js/main.0040afaa.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/amazon-connect-salesforce-cti/"><img src="/amazon-connect-salesforce-cti/img/logo.svg" alt="v5.15" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/amazon-connect-salesforce-cti/img/logo.svg" alt="v5.15" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">v5.15</b></a><a class="navbar__item navbar__link" href="/amazon-connect-salesforce-cti/docs/lightning/notices">Lightning</a><a class="navbar__item navbar__link" href="/amazon-connect-salesforce-cti/docs/classic/notices">Classic</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/amazon-connect-salesforce-cti/docs/other/earlier-versions">Earlier Versions</a><a href="https://github.com/amazon-connect/amazon-connect-salesforce-cti/tree/main/pdf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>PDF<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/amazon-connect/amazon-connect-salesforce-cti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/amazon-connect-salesforce-cti/"><img src="/amazon-connect-salesforce-cti/img/logo.svg" alt="v5.15" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/amazon-connect-salesforce-cti/img/logo.svg" alt="v5.15" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">v5.15</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/amazon-connect-salesforce-cti/docs/lightning/notices">Lightning</a></li><li class="menu__list-item"><a class="menu__link" href="/amazon-connect-salesforce-cti/docs/classic/notices">Classic</a></li><li class="menu__list-item"><a class="menu__link" href="/amazon-connect-salesforce-cti/docs/other/earlier-versions">Earlier Versions</a></li><li class="menu__list-item"><a href="https://github.com/amazon-connect/amazon-connect-salesforce-cti/tree/main/pdf" target="_blank" rel="noopener noreferrer" class="menu__link"><span>PDF<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://github.com/amazon-connect/amazon-connect-salesforce-cti" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/amazon-connect-salesforce-cti/docs/classic/notices">Notices</a></li><li class="menu__list-item"><a class="menu__link" href="/amazon-connect-salesforce-cti/docs/classic/release-notes">Release Notes</a></li><li class="menu__list-item"><a class="menu__link menuLinkText_2aKo">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/introduction/01-key-benefits-and-requirements">Key Benefits and Requirements</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2aKo">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/installation/01-installation">Installing the CTI Adapter and Salesforce Lambdas</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/installation/02-guided-setup">Setting Up The CTI Adapter Using Guided Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/installation/03-managed-package-manual-setup">Setting Up The CTI Adapter Managed Package Manually</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/installation/04-salesforce-lambdas-manual-setup">Setting Up The Salesforce Lambdas Manually</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/installation/05-upgrading-from-an-earlier-version">Upgrading from an Earlier Version</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/installation/06-cti-adapter-installation-troubleshooting">CTI Adapter Installation Troubleshooting and Common Issues</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2aKo">CTI Adapter</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/01-cti-adapter-configuration">CTI Adapter Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/02-omnipresence-agent-state-sync">Omnipresence Agent State Sync</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/03-contact-attributes-display">Contact Attributes Display</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/04-call-recording-playback">Call Recording Playback</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/05-call-display-account-page">Call Display on the Account Page</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/06-outbound-campaign-calls">Outbound Campaign Calls</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/07-amazon-connect-reports">Amazon Connect Reports in Salesforce</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/08-cti-flows">CTI Flows</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/09-localization">Localization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/10-cti-actions">CTI Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/11-recording-controls">Recording Controls</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/cti-adapter/12-chat-widget-integration">Chat Widget Integration</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2aKo">Salesforce Lambdas</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/salesforce-lambdas/01-contact-flow-salesforce-lambdas">Invoking the Amazon Connect Salesforce Lambda in a Contact Flow</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2aKo">Appendices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/appendices/appendix-a-cti-flow-sources-and-events/01-cti-flow-sources-and-events">Appendix A: CTI Flow Sources and Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/appendices/appendix-b-configuring-salesforce-as-your-identity-provider/01-configuring-salesforce-as-your-identity-provider">Appendix B: Configuring Salesforce as Your Identity Provider</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/appendices/appendix-c-cti-flow-examples/01-cti-flow-examples">Appendix C: CTI Flow Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/amazon-connect-salesforce-cti/docs/classic/appendices/appendix-d-cti-flow-blocks/01-cti-flow-blocks">Appendix D: CTI Flow Blocks</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Setting Up The Salesforce Lambdas Manually</h1></header><p>Below are manual setup instructions for the Salesforce Lambdas.</p><img src="/amazon-connect-salesforce-cti/img/classic/image100.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="salesforce-lambda-prerequisites"></a>Salesforce Lambda Prerequisites<a class="hash-link" href="#salesforce-lambda-prerequisites" title="Direct link to heading">#</a></h2><p>Consider the following prerequisites before you install the Lambda
package.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="determine-your-production-environment"></a>Determine your production Environment<a class="hash-link" href="#determine-your-production-environment" title="Direct link to heading">#</a></h3><p>In your installation notes, enter the value for &quot;Production Environment&quot;
as &quot;true&quot; or &quot;false&quot;, depending on whether the Salesforce environment
that you are deploying the package into is a production or a sandbox.
For Production, enter &quot;true&quot;. For Sandbox enter &quot;false&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="determine-your-consumer-key-and-secret"></a>Determine your Consumer Key and Secret<a class="hash-link" href="#determine-your-consumer-key-and-secret" title="Direct link to heading">#</a></h3><p>To leverage the full potential of the integration, Salesforce data needs
to be accessed from AWS environment. The AWS Serverless package comes
with a set of pre-built queries to lookup, update and create Salesforce
objects within Amazon Connect Contact Flows, in form of AWS Lambda
functions.</p><p>The Lambda function access Salesforce using the Salesforce REST API. To
get access to the environment, a Connected App must be configured with
OAuth settings enabled.</p><ol><li><p>Log in to Salesforce</p></li><li><p>Navigate to Setup &gt; Create &gt; Apps</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image101.png"><ol start="3"><li><p>Click on the &quot;New&quot; button for the Connected Apps at the bottom of the page</p></li><li><p>In the following form, fill out the Connected App Name, API Name and Contact Email with values of your choice. We recommend &quot;Amazon Connect Integration&quot; as the Connected App Name and the default value for the API name.</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image102.png"><ol start="5"><li>Select the checkbox next to &quot;Enable OAuth Settings&quot; as shown below.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image103.png"><ol start="6"><li>Ensure the Callback URL is set to <a href="https://www.salesforce.com" target="_blank" rel="noopener noreferrer">https://www.salesforce.com</a></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image104.png"><ol start="7"><li>Ensure Selected OAuth Scopes has the following values selected:</li></ol><p>a.  Access and manage your data (api)</p><p>b.  Access your basic information (id, profile, email, address, phone)</p><img src="/amazon-connect-salesforce-cti/img/classic/image105.png"><ol start="8"><li>Select the checkbox &quot;Require Secret for Web Server Flow&quot;</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image106.png"><ol start="9"><li><p>Click &quot;Save&quot; at the bottom of the screen.</p></li><li><p>Click &quot;Continue&quot; on the next screen</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image107.png"><ol start="11"><li>Once the app has been created, on the app&#x27;s detail screen, please copy the &quot;Consumer Key&quot; value to your installation notes</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image108.png"><ol start="12"><li><p>Select &quot;Click to reveal&quot; next to Consumer Secret and record this value to &quot;Consumer Secret&quot; in your installation notes.</p></li><li><p>Click &quot;Manage&quot; at the top of the page</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image109.png"><ol start="14"><li><p>On the page that appears, click &quot;Edit Policies&quot;</p></li><li><p>Set &quot;Permitted Users&quot; to &quot;Admin approved users are pre-authorizes&quot;</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image110.png"><ol start="16"><li>Click &quot;OK&quot; on the pop-up dialog:</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image111.png"><ol start="17"><li>Set &quot;IP Relaxation&quot; to &quot;Relax IP restrictions&quot;</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image112.png"><ol start="18"><li>Click &quot;Save&quot;</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="determine-your-username-password-and-security-token"></a>Determine your Username, Password and Security Token<a class="hash-link" href="#determine-your-username-password-and-security-token" title="Direct link to heading">#</a></h3><p>The authentication of the Lambda Functions requires valid user
credentials. It is a common practice to create an API user account for
this purpose.</p><ol><li><p>Log in to Salesforce</p></li><li><p>Navigate to Setup &gt; Manage Users &gt; Profiles</p></li><li><p>Click &quot;New Profile&quot;</p></li><li><p>Enter the Profile Name (i.e. &quot;API Only&quot;)</p></li><li><p>Select the existing profile to clone (The integration user\&#x27;s access to just those objects required for the integration)</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image113.png"><p>NOTE: You\&#x27;re advised to use a full Salesforce License for the user to
be able to set the below permissions and have full access to avoid any
other errors.</p><ol start="6"><li>Click &quot;Save&quot;. A New Profile is created:</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image114.png"><ol start="7"><li><p>Once the new profile page opens, select the <strong>System Permissions</strong> button</p></li><li><p>If the Lightning Experience User checkbox is selected, clear it</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image117.png"><ol start="9"><li><p>Save the system permissions, then go back to Profile Overview</p></li><li><p>Select the <em>Password Policies</em> link, click edit</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image115.png"><ol start="11"><li>Set <strong>User password expire in</strong> to <strong>Never expires</strong> <strong>NOTE:</strong> Failure to this may lead to production outages.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image116.png"><ol start="12"><li><p>Select <strong>Save</strong></p></li><li><p>Navigate to Setup &gt; Manage Apps &gt; Connected Apps</p></li><li><p>Select the app you have created in the previous step (i.e. Amazon Connect Integration)</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image118.png"><ol start="15"><li>Click &quot;Manage Profiles&quot;</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image119.png"><ol start="16"><li>Ensure the &quot;API Only&quot; profile is selected:</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image120.png"><ol start="17"><li><p>Click &quot;Save&quot; at the bottom of the page</p></li><li><p>Navigate to Setup &gt; Manage Users &gt; Users</p></li><li><p>Click &quot;New User&quot;</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image121.png"><ol start="20"><li>Set necessary fields: Last Name, Alias, Email, Username, Nickname</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image122.png"><ol start="21"><li>On the right-hand side, set the User License and Profile</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image123.png"><ol start="22"><li><p>Click &quot;Save&quot;</p></li><li><p>In <strong>Quick Find</strong>, search for &quot;Permission Sets&quot;. Select the <strong>AC_Administrator</strong> permission set.</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/lambda-install-0.png"><ol start="24"><li><p>Select <strong>Manage Assignments</strong>. Add the apiuser you just created to the permission set.</p></li><li><p>A confirmation email will be sent, with an activation link. Click the link to activate your user.</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image124.png"><p>Change (set) a password for apiuser (Considered a strong that contains
at least 20 random characters):</p><img src="/amazon-connect-salesforce-cti/img/classic/image125.png"><ol start="26"><li><p>Click &quot;Change Password&quot;</p></li><li><p>Access the apiuser personal settings by selecting the username in the top right corner, then &quot;My Settings&quot;.</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image126.png"><ol start="28"><li>Type &quot;Security Token&quot; in the Quick Find box and click &quot;Reset My Security Token&quot;.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image127.png"><ol start="29"><li>Your security token will be emailed to you</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image128.png"><ol start="30"><li>Copy the security token from the email in to your installation notes for the &quot;Access Token&quot; value.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="store-salesforce-credentials-in-aws-secrets-manager"></a>Store Salesforce credentials in AWS Secrets Manager<a class="hash-link" href="#store-salesforce-credentials-in-aws-secrets-manager" title="Direct link to heading">#</a></h3><p>To ensure that your Salesforce credentials are secure, the Lambdas
require that the credentials are stored in AWS Secrets Manager. AWS
Secrets Manager is a highly secure service that helps you store and
retrieve secrets.</p><ol><li><p>In a new browser tab, login to the AWS console</p></li><li><p>Make sure you are in the same region as your Amazon Connect
instance. You can set the region by expanding the region selector in
the upper right and choosing the region</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image129.png"><ol start="3"><li><p>Navigate to the <a href="https://console.aws.amazon.com/secretsmanager/home" target="_blank" rel="noopener noreferrer">Secrets Manager
console</a></p></li><li><p>Select <strong>Secrets</strong></p></li><li><p>Select <strong>Store a new secret</strong></p></li><li><p>Select <strong>Other types of secrets</strong></p></li><li><p>Make sure <strong>Secret key/value</strong> is selected</p></li><li><p>Enter key value pairs that match the following:</p><p>a.  <strong>Key:</strong> Password, <strong>Value:</strong> the password for the API user that
you configured in the previous section</p><p>b.  <strong>Key:</strong> ConsumerKey, <strong>Value:</strong> the Consumer Key for the
Connected App you created in the previous section</p><p>c.  <strong>Key:</strong> ConsumerSecret, <strong>Value:</strong> the Consumer Secret for the
Connected App you created in the previous section</p><p>d.  <strong>Key:</strong> AccessToken, <strong>Value:</strong> this is the access token for
the API user that you configured in the previous section</p></li><li><p>For the encryption key, click &quot;Add new key&quot;</p></li><li><p>Select <strong>Create Key</strong></p></li><li><p>Make sure key type is set to <strong>symmetric</strong></p></li><li><p>Give your key an <strong>alias</strong>, like
<em>SalesforceCredentialsSecretsManagerKey</em></p></li><li><p>Click Next</p></li><li><p>Select administrators you want to have access permission to change
the key policy. Make sure you are being as restrictive as possible</p></li><li><p>Click Next</p></li><li><p>Select the users and roles you want to have access to the Salesforce
credentials in Secrets Manager. Make sure you are being as
restrictive as possible</p></li><li><p>Click Next</p></li><li><p>Click Finish</p></li><li><p>Navigate back to the Secrets Manager setup tab</p></li><li><p>Select the key you just created</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image130.png"><ol start="21"><li><p>Click Next</p></li><li><p>Give your secret a name, like <em>SalesforceCredentials</em></p></li><li><p>Click Next</p></li><li><p>Make sure <strong>Disable automatic rotation</strong> is disabled</p></li><li><p>Click Next</p></li><li><p>Click Store</p></li><li><p>Select the secret you just created, and copy the Secret ARN</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image131.png"><ol start="28"><li>You should now have all of the information you need to install the
package</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="install-the-amazon-connect-salesforce-lambda-package"></a>Install the Amazon Connect Salesforce Lambda package<a class="hash-link" href="#install-the-amazon-connect-salesforce-lambda-package" title="Direct link to heading">#</a></h2><ol><li><p>Login into your AWS Account</p></li><li><p>Navigate AWS Serverless Application Repository
(<a href="https://aws.amazon.com/serverless/serverlessrepo/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/serverless/serverlessrepo/</a>)</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image132.png"><ol start="3"><li>Click on the Search (magnifying glass) and type in Amazon Connect
Salesforce.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image133.png"><ol start="4"><li>Select AmazonConnectSalesForceLambdas and click &quot;Deploy&quot;</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image134.png"><ol start="5"><li>Fill in all Salesforce related fields in &quot;Configure application
parameters&quot;.\
All values should be available in your installation notes:</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image135.png"><img src="/amazon-connect-salesforce-cti/img/classic/image136.png"><ol start="6"><li><p>The Lambda package includes additional features which can be enabled
or disabled, based on particular use-case:</p><p>a.  <em>PostcallCTRImportEnabled</em> -- if set to true, the package will
include a feature to import Amazon Connect CTRs into your
Salesforce Org. Once enabled, you can decide which CTR records
should be imported, by setting a custom attribute
(<em>postcallCTRImportEnabled</em>) in your Contact Flow. This feature
requires you to provide <em>CTRKinesisARN</em>.</p><p>b.  <em>PostcallRecordingImportEnabled</em> -- if set to true, the package
will include a feature to import Amazon Connect Call Recording
(wav) files into your Salesforce Org. This feature is not
required if you only need a call recording link in your
Salesforce Org. Once enabled, you can decide which Call
Recordings should be imported, by setting a custom attribute
(<em>postcallRecordingImportEnabled</em>) in your Contact Flow. This
feature requires you to provide: <em>CTRKinesisARN,
ConnectRecordingS3BucketName</em> and <em>TranscribeOutputS3BucketName</em></p><p>c.  <em>PostcallTranscribeEnabled</em> -- if set to true, the package will
include a feature to transcribe Amazon Connect Call Recordings,
using Amazon Transcribe, and provide Speech Analytics, using
Amazon Comprehend, then import results into your Salesforce Org.
Once enabled, you can decide which Call Recordings should be
transcribed and analyzed, by setting custom attributes
(<em>postcallTranscribeEnabled</em>, <em>postcallTranscribeLanguage</em> and
<em>postcallTranscribeComprehendAnalysis</em>) in your Contact Flow.
This feature requires you to provide: <em>CTRKinesisARN,
ConnectRecordingS3BucketName</em> and <em>TranscribeOutputS3BucketName</em></p><p>d.  <em>RealtimeReportImportEnabled</em> -- if set to true, the package
will include a feature to publish Amazon Connect Queue Metrics
into your Salesforce Org. This feature requires you to provide
<em>AmazonConnectInstanceId</em></p><p>e.  <em>HistoricalReportingImportEnabled</em> -- if set to true, the
package will include a feature to import Amazon Connect Queue
and Agent Historical Metrics into your Salesforce Org. This
feature requires you to provide <em>ConnectReportingS3BucketName</em></p><p>f.  <em>CTRKinesisARN</em> -- please set Amazon Kinesis Stream ARN that is
attached to you Amazon Connect instance as Contact Trace Records
destination. Amazon Kinesis Firehose is not supported. This
parameter is mandatory for certain features, please see above.</p><p>g.  <em>ConnectRecordingS3BucketName</em> -- this is the S3 bucket where
Amazon Connect stores call recordings. This parameter is
mandatory for certain features, please see above.</p><p>h.  <em>ConnectReportingS3BucketName</em> -- this is the S3 bucket name
where Amazon Connect stores schedule reports. This parameter is
mandatory for Historical Reporting Import.</p><p>i.  <em>AmazonConnectInstanceId</em> -- this parameter is mandatory for
Realtime Reporting Import</p><p>j.  <em>TranscribeOutputS3BucketName</em> -- this is the S3 bucket where
Amazon Transcribe stores the output. You can use an existing
bucket, or create a new one, as the installation process doesn&#x27;t
create one for you. This parameter in mandatory certain
features, please see above.</p><p>k.  <em>SalesforceHost:</em> The full domain for your salesforce org. For
example
<code>https://mydevorg-dev-ed.my.salesforce.com</code>.
Please make sure that the host starts with <code>https</code>, and that the url
ends with <code>.my.salesforce.com</code>. This url can be found in <code>Setup</code> -&gt; <code>My Domain</code>.</p></li><li><p>Once completed, click &quot;Deploy&quot; function:</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image137.png"><ol start="8"><li>The package provides a single Lambda function (sfInvokeAPI) that
supports multiple operations, like lookup, create and update. For
the initial validation, sample events are provided within the
function. Click on the function name and check the list of files in
the editor.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image138.png"><ol start="9"><li>To validate a phone number lookup, double-click on
event-phoneLookup.json file and copy the text in your clipboard.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image139.png"><ol start="10"><li>In the top-right corner, click the drop-down arrow next to the
&quot;Test&quot; button and select &quot;Configure test events&quot;</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image140.png"><ol start="11"><li>Select &quot;Create new test event&quot;, set Event name (i.e. phoneLookup)
and paste the JSON payload you&#x27;ve copied in the previous step.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image141.png"><ol start="12"><li><p>Click &quot;Create&quot; button</p></li><li><p>From the drop-down list, select your &quot;eventLookup&quot; and click &quot;Test&quot;
button</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image142.png"><ol start="14"><li>If successful, the result will contain fields defined in &quot;sf_fields&quot;
parameter in the invocation event</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image143.png"><ol start="15"><li>As a next step, we are going to use the ContactId provided and
create a Case in Salesforce. Double-click on &quot;event-create.json&quot;
file and set the ContactId value from the previous step. Copy the
JSON text into your clipboard.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image144.png"><ol start="16"><li>In the top-right corner, click the drop-down arrow next to the
&quot;Test&quot; button and select &quot;Configure test events&quot;</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image145.png"><ol start="17"><li>Select &quot;Create new test event&quot;, set Event name (i.e. createCase) and
paste the JSON payload you&#x27;ve copied in the previous step.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image146.png"><ol start="18"><li><p>Click &quot;Create&quot; button</p></li><li><p>From the drop-down list, select your &quot;createCase&quot; and click &quot;Test&quot;
button</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image147.png"><ol start="20"><li>If successful, the result will contain a Case Id for newly created
case:</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image148.png"><ol start="21"><li>As defined in the event payload, Status is &quot;New&quot; and Priority is
&quot;Low&quot;. We are going to use the update operation to close the case.
Copy the Case Id provided in the previous step, then double-click on
&quot;event-update.json&quot; file and paste the Case Id in &quot;sf_id&quot; parameter:</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image149.png"><ol start="22"><li>In the top-right corner, click the drop-down arrow next to the
&quot;Test&quot; button and select &quot;Configure test events&quot;</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image150.png"><ol start="23"><li>Select &quot;Create new test event&quot;, set Event name (i.e. closeCase) and
paste the JSON payload you&#x27;ve copied in the previous step.</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image151.png"><ol start="24"><li><p>Click &quot;Create&quot; button</p></li><li><p>From the drop-down list, select your &quot;closeCase&quot; and click &quot;Test&quot;
button</p></li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image152.png"><ol start="26"><li>If successful, the result will be HTTP code 204 (&quot;No Content&quot;
success code):</li></ol><img src="/amazon-connect-salesforce-cti/img/classic/image153.png"><ol start="27"><li>Login in to Salesforce and search for Case and it&#x27;s details. The
Case status should be &quot;Closed&quot;.</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/amazon-connect/amazon-connect-salesforce-cti/docs/classic/02-installation/04-salesforce-lambdas-manual-setup.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/amazon-connect-salesforce-cti/docs/classic/installation/03-managed-package-manual-setup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Setting Up The CTI Adapter Managed Package Manually</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/amazon-connect-salesforce-cti/docs/classic/installation/05-upgrading-from-an-earlier-version"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrading from an Earlier Version Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#salesforce-lambda-prerequisites" class="table-of-contents__link">Salesforce Lambda Prerequisites</a><ul><li><a href="#determine-your-production-environment" class="table-of-contents__link">Determine your production Environment</a></li><li><a href="#determine-your-consumer-key-and-secret" class="table-of-contents__link">Determine your Consumer Key and Secret</a></li><li><a href="#determine-your-username-password-and-security-token" class="table-of-contents__link">Determine your Username, Password and Security Token</a></li><li><a href="#store-salesforce-credentials-in-aws-secrets-manager" class="table-of-contents__link">Store Salesforce credentials in AWS Secrets Manager</a></li></ul></li><li><a href="#install-the-amazon-connect-salesforce-lambda-package" class="table-of-contents__link">Install the Amazon Connect Salesforce Lambda package</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
<script src="/amazon-connect-salesforce-cti/assets/js/runtime~main.c8b8a721.js"></script>
<script src="/amazon-connect-salesforce-cti/assets/js/main.0040afaa.js"></script>
</body>
</html>